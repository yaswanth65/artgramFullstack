<!DOCTYPE html>
<html>
  <head>
    <title>Auth Test</title>
  </head>
  <body>
    <h1>Authentication Test</h1>
    <div id="result"></div>

    <script>
      const testAuth = async () => {
        const resultDiv = document.getElementById("result");

        try {
          resultDiv.innerHTML += "<p>Testing registration...</p>";

          // Test registration
          const registerResponse = await fetch(
            "http://localhost:5001/api/auth/register",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                name: "Test User",
                email: `test${Date.now()}@example.com`, // Unique email
                password: "password123",
              }),
            }
          );

          const registerResult = await registerResponse.json();
          resultDiv.innerHTML += `<p>Registration status: ${registerResponse.status}</p>`;
          resultDiv.innerHTML += `<p>Registration result: ${JSON.stringify(
            registerResult,
            null,
            2
          )}</p>`;

          if (registerResponse.ok) {
            resultDiv.innerHTML += "<p>✅ Registration successful!</p>";

            // Test login with the registered user
            const email = `test${Date.now()}@example.com`;
            const loginResponse = await fetch(
              "http://localhost:5001/api/auth/login",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  email: registerResult.user.email,
                  password: "password123",
                }),
              }
            );

            const loginResult = await loginResponse.json();
            resultDiv.innerHTML += `<p>Login status: ${loginResponse.status}</p>`;
            resultDiv.innerHTML += `<p>Login result: ${JSON.stringify(
              loginResult,
              null,
              2
            )}</p>`;

            if (loginResponse.ok) {
              resultDiv.innerHTML += "<p>✅ Login successful!</p>";
            } else {
              resultDiv.innerHTML += `<p>❌ Login failed: ${loginResult.message}</p>`;
            }
          } else {
            resultDiv.innerHTML += `<p>❌ Registration failed: ${registerResult.message}</p>`;
          }
        } catch (error) {
          resultDiv.innerHTML += `<p>❌ Error: ${error.message}</p>`;
          console.error("Error:", error);
        }
      };

      // Run test when page loads
      testAuth();
    </script>
  </body>
</html>
